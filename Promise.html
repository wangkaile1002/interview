<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Promuse基本原理</title>
</head>

<body>
  <script>
    Promise.resolve('wang').then(result => {
      console.log(result);
    })
    Promise.selfAll = function (arr) {
      return new Promise((resolve, reject) => {
        let Promises = Array.from(arr);
        if (Promises.length == 0) {
          resolve([])
        } else {
          let result = [];
          let index = 0;
          for (let i = 0; i < Promises.length; i++) {
            Promise.resolve(Promises[i]).then(res => {
              result[i] = res;
              if (++index == Promises.length) {
                resolve(result)
              }
            }, err => {
              reject(err);
              return;
            })
          }
        }
      })
    }
    let p1 = new Promise(function (resolve, reject) {
      reject(42);
    })
    let p2 = new Promise(function (resolve, reject) {
      resolve(43);
    })
    let p3 = new Promise(function (resolve, reject) {
      reject(44);
    })
    Promise.selfAll([p1, p2, p3]).then(res => {
      console.log('success', res);
    }).catch(err => {
      console.log('error', err);
    })
    Promise.selfAll2 = function (arr) {
      return new Promise((resolve, reject) => {
        let promises = Array.from(arr);
        if (promises.length == 0) {
          resolve([])
        } else {
          let index = 0, result = [];
          for (let i = 0; i < promises.length; i++) {
            Promise.resolve(promises[i]).then(res => {
              result[i] = res;
              if (++index == promises.length) {
                resolve(result)
              }
            }, err => {
              reject(err);
              return;
            })
          }

        }
      })
    }
    let p4 = new Promise(function (resolve, reject) {
      reject(55);
    })
    let p5 = new Promise(function (resolve, reject) {
      resolve(56);
    })
    Promise.selfAll2([p4, p5]).then(res => {
      console.log('success', res);
    }).catch(err => {
      console.log("error", err)
    })
  </script>
  <script>
    Promise.selfAll3 = function (arr) {
      return new Promise((resolve, reject) => {


        let promises = Array.from(arr);
        if (promises.length == 0) {
          resolve([])
        } else {
          let count = 0, result = [];
          for (let i = 0; i < promises.length; i++) {
            Promise.resolve(promises[i]).then(res => {
              result[i] = res;
              if (++count == promises.length) {
                resolve(result);
              }
            }).catch(err => {
              reject(err);
            })
          }
        }
      })
    }
    let p6 = new Promise(function (resolve, reject) {
      resolve(55);
    })
    let p7 = new Promise(function (resolve, reject) {
      resolve(56);
    })
    Promise.selfAll3([p6, p7]).then(res => {
      console.log('successP', res);
    }).catch(err => {
      console.log("errorP", err)
    })
  </script>
  <script>
    Promise.selfAll4 = function () {
      return new Promise((resolve, reject) => {
        // let promises = Array.from(arr);
        let promises = Array.prototype.slice.call(arguments);
        // debugger
        if (promises.length == 0) {
          reslove([])
        } else {
          let count = 0, result = [];
          for (let i = 0; i < promises.length; i++) {
            Promise.resolve(promises[i]).then(res => {
              result[i] = res;
              if (++count == promises.length) {
                resolve(result)
              }
            }, err => {
              reject(err)
            })
          }
        }
      })
    }
    let p8 = new Promise(function (resolve, reject) {
      resolve('p8');
    })
    let p9 = new Promise(function (resolve, reject) {
      resolve('p9');
    })
    Promise.selfAll4(p8, p9).then(res => {
      console.log('success_selfAll4', res);
    }).catch(err => {
      console.log('error_selfAll4', err);
    })
  </script>
  <script>
    Promise.selfAll5 = function (arr) {
      return new Promise((reslove, reject) => {
        let promises = Array.from(arr);
        if (promises.length == 0) {
          reslove([])
        } else {
          let count = 0, result = [], i = 0;
          for (; i < promises.length; i++) {
            Promise.resolve(promises[i]).then(res => {
              result.push(res);
              if (++count == promises.length) {
                reslove(result)
              }
            }, err => {
              reject(err)
            })
          }
        }
      })
    }
    let p10 = new Promise(function (resolve, reject) {
      reject('p10');
    })
    let p11 = new Promise(function (resolve, reject) {
      resolve('p11');
    })
    Promise.selfAll5([p10,p11]).then(res=>{
      console.log('success_selfAll5',res);
    }).catch(err=>{
      console.log('error_selfAll5',err);
    })
  </script>
</body>

</html>